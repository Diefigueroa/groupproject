<html>
<head>
  <title>A Leaflet map!</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <style>
   #mapid{ width: 800px; height: 800px; }
  </style>
</head>
<body>

  <div id="mapid"></div>

  <script>

  // initialize the map
  var map_center = [
	  40.782091,  // Latitude
          -73.964285  // Longitude
        ];
  var zoom_level = 14;
  var mymap = L.map('mapid').setView(map_center, zoom_level);

  // load a tile layer
  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    accessToken: 'pk.eyJ1IjoiZGYyNzYxIiwiYSI6ImNrM3R3YmVvZDA3Z2EzaXFtcHlqMzZxbWIifQ.f0B8E52UBwVYP184XuIRkQ'
}).addTo(mymap);



{% for squirrel in n %}
        var point_lat_lon = [{{ squirrel.Latitude }}, {{ squirrel.Longitude }}];
        var marker = L.marker(point_lat_lon).addTo(mymap);
  {% endfor %}
  
  </script>
	
  <script>

    var bookIcon = L.icon({
        iconUrl: '/static/images/marker-icon.png',
        iconSize:     [35, 35], // size of the icon
        iconAnchor:   [17, 35], // point of the icon which will correspond to marker's location
        popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
        });

    var markersLayer = L.markerClusterGroup();

    mymap.addLayer(markersLayer);

    var controlSearch = new L.Control.Search({
        position:'topright',
        layer: markersLayer,
        initial: false,
        zoom: 12,
        marker: false
    });

    mymap.addControl( controlSearch );

    function populateMap(data){
        for(i in data) {
        var title = data[i].title,	//value searched
            loc = data[i].loc,		//position found
            url = data[i].url,
            marker = new L.Marker(new L.latLng(loc), {title: title, icon: bookIcon} );//se property searched
        marker.bindPopup('<p><a href="'+ url + '">' + title + '</a></p>');
        markersLayer.addLayer(marker);
        }
    }

    // use context variable instead of making AJAX call
    var map_books =  JSON.parse('{{ map_books }}')
    var new_lat = map_books[0].loc[0]
    var new_lon = map_books[0].loc[1]
    mymap.setView([0, 0], 2);
    populateMap(map_books)

  </script>

</body>
</html>
